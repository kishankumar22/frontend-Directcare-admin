# Advanced Product Features - Complete Documentation

**Date:** December 15, 2025
**Project:** Direct Care E-Commerce Platform
**Version:** 2.0

---

## Table of Contents

1. [Overview](#overview)
2. [Feature 1: Multiple Brands Per Product](#feature-1-multiple-brands-per-product)
3. [Feature 2: Admin Comment History & Audit Trail](#feature-2-admin-comment-history--audit-trail)
4. [Feature 3: Product Edit Locking (WordPress Style)](#feature-3-product-edit-locking-wordpress-style)
5. [Feature 4: Back-in-Stock Notifications](#feature-4-back-in-stock-notifications)
6. [Feature 5: Low Quantity Admin Alerts](#feature-5-low-quantity-admin-alerts)
7. [Feature 6: Order Status Management](#feature-6-order-status-management)
8. [Database Schema Changes](#database-schema-changes)
9. [API Endpoints Reference](#api-endpoints-reference)
10. [Configuration Guide](#configuration-guide)
11. [Testing Guide](#testing-guide)

---

## Overview

Is document mein 7 major features implement kiye gaye hain jo aapke e-commerce platform ko production-ready aur enterprise-level banate hain.

### Implemented Features Summary:

‚úÖ Multiple brands per product support
‚úÖ Admin comment history tracking
‚úÖ Concurrent edit protection
‚úÖ Customer notification system
‚úÖ Inventory alert system
‚úÖ Proper order status flow
‚úÖ Enum serialization fix

---

## Feature 1: Multiple Brands Per Product

### Problem Statement
Pehle ek product sirf ek brand se associate ho sakta tha. Lekin real scenario mein, ek hi product multiple brands ka ho sakta hai (e.g., Incontinence Pads - Tena, Depend, Always brands mein available hai).

### Solution
Many-to-Many relationship implement kiya gaya hai Products aur Brands ke beech.

### Database Schema

```sql
CREATE TABLE ProductBrands (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    ProductId UNIQUEIDENTIFIER NOT NULL,
    BrandId UNIQUEIDENTIFIER NOT NULL,
    IsPrimary BIT NOT NULL DEFAULT 0,
    DisplayOrder INT NOT NULL DEFAULT 1,
    CreatedAt DATETIME2 NOT NULL,
    UpdatedAt DATETIME2 NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_ProductBrands_Products FOREIGN KEY (ProductId)
        REFERENCES Products(Id) ON DELETE CASCADE,
    CONSTRAINT FK_ProductBrands_Brands FOREIGN KEY (BrandId)
        REFERENCES Brands(Id) ON DELETE CASCADE,
    CONSTRAINT UQ_ProductBrands_ProductId_BrandId
        UNIQUE (ProductId, BrandId)
)
```

### How It Works

#### 1. Product Create Example:

**Request:**
```json
POST /api/products

{
  "name": "Adult Incontinence Pads",
  "sku": "INC-PAD-001",
  "price": 12.99,
  "brandIds": [
    "brand-guid-1",  // Tena (Primary)
    "brand-guid-2",  // Depend
    "brand-guid-3"   // Always
  ],
  "categoryId": "category-guid",
  "description": "High quality incontinence pads"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Product created successfully",
  "data": {
    "id": "product-guid",
    "name": "Adult Incontinence Pads",
    "brands": [
      {
        "id": "brand-guid-1",
        "name": "Tena",
        "isPrimary": true,
        "displayOrder": 1
      },
      {
        "id": "brand-guid-2",
        "name": "Depend",
        "isPrimary": false,
        "displayOrder": 2
      },
      {
        "id": "brand-guid-3",
        "name": "Always",
        "isPrimary": false,
        "displayOrder": 3
      }
    ]
  }
}
```

#### 2. Product Update Example:

**Request:**
```json
PUT /api/products/{productId}

{
  "brandIds": [
    "brand-guid-1",
    "brand-guid-4"  // New brand added, brand-2 and brand-3 removed
  ]
}
```

### Business Logic

- **First brand** in the array is automatically marked as **Primary**
- **DisplayOrder** is assigned based on array position (1, 2, 3...)
- When updating, **old brands are removed** and **new brands are added**
- Product can have **legacy BrandId** (backward compatibility) + new multiple brands

### Use Cases

1. **Multi-brand products:** Sell same product from different manufacturers
2. **Private label:** Show both store brand and original manufacturer
3. **Generic alternatives:** Link generic products with branded equivalents

---

## Feature 2: Admin Comment History & Audit Trail

### Problem Statement
Jab multiple admins ek product ko manage karte hain, toh pata nahi chalta ki kisne kab aur kya comment add ya change kiya.

### Solution
Complete audit trail implement kiya gaya hai jo har change ko track karta hai.

### Database Schema

```sql
CREATE TABLE ProductAdminCommentHistories (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    ProductId UNIQUEIDENTIFIER NOT NULL,
    OldComment NVARCHAR(MAX) NULL,
    NewComment NVARCHAR(MAX) NULL,
    ChangedBy NVARCHAR(255) NOT NULL,
    ChangedAt DATETIME2 NOT NULL,
    ChangeReason NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 NOT NULL,
    UpdatedAt DATETIME2 NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_ProductAdminCommentHistories_Products
        FOREIGN KEY (ProductId) REFERENCES Products(Id) ON DELETE CASCADE
)

CREATE INDEX IX_ProductAdminCommentHistories_ProductId
    ON ProductAdminCommentHistories(ProductId);
CREATE INDEX IX_ProductAdminCommentHistories_ChangedAt
    ON ProductAdminCommentHistories(ChangedAt);
```

### How It Works

#### Automatic Tracking:

Jab bhi admin product update karta hai aur AdminComment change hota hai, automatically ek entry create hoti hai.

**Example Scenario:**

1. **Initial State:**
   - Product AdminComment: NULL

2. **First Update by admin@example.com:**
   - New Comment: "Product needs price review"

   **History Entry Created:**
   ```json
   {
     "productId": "product-guid",
     "oldComment": null,
     "newComment": "Product needs price review",
     "changedBy": "admin@example.com",
     "changedAt": "2025-12-15T10:30:00Z"
   }
   ```

3. **Second Update by manager@example.com:**
   - New Comment: "Price updated to ¬£15.99"

   **History Entry Created:**
   ```json
   {
     "productId": "product-guid",
     "oldComment": "Product needs price review",
     "newComment": "Price updated to ¬£15.99",
     "changedBy": "manager@example.com",
     "changedAt": "2025-12-15T14:45:00Z"
   }
   ```

### View Comment History

**Query:**
```sql
SELECT
    OldComment,
    NewComment,
    ChangedBy,
    ChangedAt,
    ChangeReason
FROM ProductAdminCommentHistories
WHERE ProductId = 'product-guid'
    AND IsDeleted = 0
ORDER BY ChangedAt DESC;
```

**Result:**x`
```
| Old Comment              | New Comment              | Changed By           | Changed At          |
|--------------------------|--------------------------|----------------------|---------------------|
| Product needs price...   | Price updated to ¬£15.99  | manager@example.com  | 2025-12-15 14:45   |
| NULL                     | Product needs price...   | admin@example.com    | 2025-12-15 10:30   |
```

### Benefits

- **Full accountability:** Har change ka record
- **Compliance:** Audit requirements meet karta hai
- **Debugging:** Kya change hua tha, kab hua, kisne kiya - sab pata chalega
- **Team collaboration:** Multiple admins efficiently kaam kar sakte hain

---

## Feature 3: Product Edit Locking (WordPress Style)

### Problem Statement
Jab 2 admins same time pe same product edit karte hain, toh ek ke changes overwrite ho jate hain. Data loss ho sakta hai.

### Solution
WordPress jaisa edit locking mechanism implement kiya gaya hai.

### Database Schema

```sql
CREATE TABLE ProductEditLocks (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    ProductId UNIQUEIDENTIFIER NOT NULL,
    LockedBy NVARCHAR(255) NOT NULL,
    LockedByEmail NVARCHAR(255) NULL,
    LockedAt DATETIME2 NOT NULL,
    ExpiresAt DATETIME2 NOT NULL,
    UserSessionId NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 NOT NULL,
    UpdatedAt DATETIME2 NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_ProductEditLocks_Products
        FOREIGN KEY (ProductId) REFERENCES Products(Id) ON DELETE CASCADE
)

CREATE UNIQUE INDEX IX_ProductEditLocks_ProductId
    ON ProductEditLocks(ProductId);
CREATE INDEX IX_ProductEditLocks_ExpiresAt
    ON ProductEditLocks(ExpiresAt);
```

### How It Works

#### Step 1: Acquire Lock

**Request:**
```http
POST /api/products/{productId}/lock?durationMinutes=15
Authorization: Bearer {admin-token}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "Product edit lock acquired successfully",
  "data": {
    "id": "lock-guid",
    "productId": "product-guid",
    "lockedBy": "admin@example.com",
    "lockedByEmail": "admin@example.com",
    "lockedAt": "2025-12-15T10:00:00Z",
    "expiresAt": "2025-12-15T10:15:00Z",
    "isLocked": true
  }
}
```

#### Step 2: Try to Edit (Another User)

Jab dusra admin same product edit karne ki koshish karta hai:

**Request:**
```http
PUT /api/products/{productId}
Authorization: Bearer {another-admin-token}

{
  "name": "Updated Name"
}
```

**Response (Conflict - 409):**
```json
{
  "success": false,
  "message": "This product is currently being edited by admin@example.com (admin@example.com). Please try again later or request access from the user.",
  "data": null
}
```

#### Step 3: Release Lock

**Request:**
```http
DELETE /api/products/{productId}/lock
Authorization: Bearer {admin-token}
```

**Response:**
```json
{
  "success": true,
  "message": "Product edit lock released successfully",
  "data": true
}
```

### Lock Behavior

1. **Default Duration:** 15 minutes (customizable)
2. **Auto-Extend:** Same user lock acquire kare toh duration extend ho jata hai
3. **Auto-Expire:** Time out hone ke baad automatically lock remove ho jata hai
4. **Force Release:** Only lock holder release kar sakta hai (or expired lock)

### Frontend Integration Example

```javascript
// When admin opens product edit page
async function openProductEdit(productId) {
  try {
    // Acquire lock
    const lockResponse = await fetch(
      `/api/products/${productId}/lock?durationMinutes=15`,
      { method: 'POST', headers: { 'Authorization': `Bearer ${token}` } }
    );

    if (lockResponse.ok) {
      // Show edit form
      showEditForm();

      // Extend lock every 10 minutes
      setInterval(() => extendLock(productId), 10 * 60 * 1000);
    }
  } catch (error) {
    // Lock already held by another user
    alert(error.message);
  }
}

// When admin saves or cancels
async function closeProductEdit(productId) {
  // Release lock
  await fetch(`/api/products/${productId}/lock`, {
    method: 'DELETE',
    headers: { 'Authorization': `Bearer ${token}` }
  });
}
```

### Benefits

- **Prevents conflicts:** No data overwrite
- **User awareness:** Dusre user ko pata chal jata hai ki kaun edit kar raha hai
- **Auto-recovery:** Expired locks automatically remove ho jati hain
- **Professional UX:** Enterprise-level editing experience

---

## Feature 4: Back-in-Stock Notifications

### Problem Statement
Jab product out of stock ho jata hai, customers wait karte rehte hain ya competitor se kharid lete hain. Sale loss ho jata hai.

### Solution
Customer apna email subscribe kar sakta hai. Jaise hi product stock mein aata hai, automatic email bhej diya jata hai.

### Database Schema

```sql
CREATE TABLE BackInStockSubscriptions (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    ProductId UNIQUEIDENTIFIER NOT NULL,
    ProductVariantId UNIQUEIDENTIFIER NULL,
    CustomerEmail NVARCHAR(255) NOT NULL,
    CustomerId UNIQUEIDENTIFIER NULL,
    SubscribedAt DATETIME2 NOT NULL,
    IsNotified BIT NOT NULL DEFAULT 0,
    NotifiedAt DATETIME2 NULL,
    NotificationStatus NVARCHAR(50) NULL DEFAULT 'Pending',
    CreatedAt DATETIME2 NOT NULL,
    UpdatedAt DATETIME2 NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,

    CONSTRAINT FK_BackInStockSubscriptions_Products
        FOREIGN KEY (ProductId) REFERENCES Products(Id) ON DELETE CASCADE,
    CONSTRAINT FK_BackInStockSubscriptions_ProductVariants
        FOREIGN KEY (ProductVariantId) REFERENCES ProductVariants(Id)
)

CREATE INDEX IX_BackInStockSubscriptions_ProductId
    ON BackInStockSubscriptions(ProductId);
CREATE INDEX IX_BackInStockSubscriptions_CustomerEmail
    ON BackInStockSubscriptions(CustomerEmail);
CREATE INDEX IX_BackInStockSubscriptions_IsNotified
    ON BackInStockSubscriptions(IsNotified);
CREATE INDEX IX_BackInStockSubscriptions_ProductId_CustomerEmail
    ON BackInStockSubscriptions(ProductId, CustomerEmail);
```

### How It Works

#### Step 1: Customer Subscribes (Product Out of Stock)

**Frontend Example:**
```html
<div class="out-of-stock-notice">
  <p>This product is currently out of stock</p>
  <button onclick="subscribeBackInStock()">Notify me when available</button>
</div>

<script>
async function subscribeBackInStock() {
  const email = prompt("Enter your email:");

  const response = await fetch(`/api/products/${productId}/back-in-stock-subscription`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      customerEmail: email,
      productVariantId: null // or specific variant ID
    })
  });

  if (response.ok) {
    alert("You'll be notified when this product is back in stock!");
  }
}
</script>
```

**Request:**
```http
POST /api/products/{productId}/back-in-stock-subscription

{
  "customerEmail": "customer@example.com",
  "productVariantId": null
}
```

**Response:**
```json
{
  "success": true,
  "message": "Successfully subscribed to back-in-stock notifications",
  "data": {
    "id": "subscription-guid",
    "productId": "product-guid",
    "productVariantId": null,
    "customerEmail": "customer@example.com",
    "subscribedAt": "2025-12-15T10:00:00Z",
    "isNotified": false,
    "productName": "Adult Incontinence Pads",
    "variantName": null
  }
}
```

#### Step 2: Admin Updates Stock

Jab admin product update karke stock add karta hai:

```http
PUT /api/products/{productId}

{
  "stockQuantity": 100  // Stock 0 se 100 ho gaya
}
```

**Backend automatically:**
1. Detect karta hai ki stock 0 se > 0 ho gaya
2. Sabhi pending subscriptions fetch karta hai
3. Email send karta hai sabhi subscribers ko
4. Subscription status update karta hai "Sent" pe

#### Step 3: Email Sent to Customer

**Email Template:**
```html
<!DOCTYPE html>
<html>
<body>
  <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
    <div style="background-color: #4CAF50; color: white; padding: 20px; text-align: center;">
      <h1>üéâ Great News!</h1>
    </div>
    <div style="padding: 20px; background-color: #f9f9f9;">
      <h2>Your requested product is back in stock!</h2>
      <div style="background-color: #fff; border: 2px solid #4CAF50; padding: 15px; margin: 15px 0; text-align: center;">
        <h3>Adult Incontinence Pads</h3>
        <p>This product is now available for purchase.</p>
      </div>
      <p>Don't miss out - stock is limited and may sell out quickly!</p>
      <p style="text-align: center;">
        <a href="https://yoursite.com/products/{productId}"
           style="background-color: #4CAF50; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px;">
          View Product
        </a>
      </p>
    </div>
    <div style="text-align: center; padding: 20px; color: #666; font-size: 12px;">
      <p>Direct Care E-Commerce | support@spaceboxfulfilment.com</p>
      <p>You received this email because you subscribed to back-in-stock notifications.</p>
    </div>
  </div>
</body>
</html>
```

### Notification Logic

**Code Flow:**
```csharp
// In UpdateProductCommandHandler.cs
private async Task CheckAndNotifyLowStockAsync(Product product, CancellationToken cancellationToken)
{
    // Check if product was out of stock and now back in stock
    if (product.StockQuantity > 0)
    {
        await _mediator.Send(new NotifyBackInStockSubscribersCommand
        {
            ProductId = product.Id,
            ProductVariantId = null
        }, cancellationToken);
    }
}
```

### Database Records

**Before Notification:**
```sql
SELECT * FROM BackInStockSubscriptions WHERE ProductId = 'product-guid';

| CustomerEmail         | IsNotified | NotificationStatus |
|-----------------------|------------|--------------------|
| customer1@example.com | 0          | Pending            |
| customer2@example.com | 0          | Pending            |
| customer3@example.com | 0          | Pending            |
```

**After Notification:**
```sql
| CustomerEmail         | IsNotified | NotificationStatus | NotifiedAt          |
|-----------------------|------------|--------------------|--------------------|
| customer1@example.com | 1          | Sent               | 2025-12-15 10:30   |
| customer2@example.com | 1          | Sent               | 2025-12-15 10:30   |
| customer3@example.com | 1          | Sent               | 2025-12-15 10:30   |
```

### Benefits

- **Increased Sales:** Customers ko immediately pata chal jata hai
- **Customer Retention:** Competitor pe nahi jaenge
- **Automated:** Manual effort nahi chahiye
- **Professional:** Enterprise-level customer service

---

## Feature 5: Low Quantity Admin Alerts

### Problem Statement
Stock khatam hone se pehle admin ko pata nahi chalta. Last minute mein panic situation ho jati hai.

### Solution
Configurable threshold set kar sakte hain. Jab stock threshold se neeche jata hai, admin ko automatic email alert milta hai.

### How It Works

#### Step 1: Configure Product

**Request:**
```http
PUT /api/products/{productId}

{
  "notifyAdminForQuantityBelow": true,
  "notifyQuantityBelow": 10,
  "stockQuantity": 50
}
```

**Fields:**
- `notifyAdminForQuantityBelow`: Enable/disable alert (true/false)
- `notifyQuantityBelow`: Threshold quantity (e.g., 10)
- `stockQuantity`: Current stock

#### Step 2: Stock Decreases

Jab order place hota hai ya stock update hota hai:

```http
PUT /api/products/{productId}

{
  "stockQuantity": 8  // Now below threshold of 10
}
```

#### Step 3: Automatic Alert

Backend automatically detect karta hai aur admin ko email send karta hai.

**Email Template:**
```html
<!DOCTYPE html>
<html>
<body>
  <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
    <div style="background-color: #FF9800; color: white; padding: 20px; text-align: center;">
      <h1>‚ö†Ô∏è Low Stock Alert</h1>
    </div>
    <div style="padding: 20px; background-color: #f9f9f9;">
      <h2>Product stock is running low</h2>
      <div style="background-color: #fff3cd; border: 2px solid #FF9800; padding: 15px; margin: 15px 0;">
        <p><strong>Product Name:</strong> Adult Incontinence Pads</p>
        <p><strong>SKU:</strong> INC-PAD-001</p>
        <p><strong>Current Stock:</strong> 8 units</p>
        <p><strong>Alert Threshold:</strong> 10 units</p>
      </div>
      <p>Please consider restocking this product to avoid stockouts.</p>
    </div>
    <div style="text-align: center; padding: 20px; color: #666; font-size: 12px;">
      <p>Direct Care E-Commerce - Admin Notification System</p>
      <p>This is an automated alert. Please do not reply to this email.</p>
    </div>
  </div>
</body>
</html>
```

### Configuration Required

`appsettings.json`:
```json
{
  "EmailSettings": {
    "SmtpServer": "smtp.gmail.com",
    "Port": "587",
    "Username": "your-email@gmail.com",
    "Password": "your-app-password",
    "AdminEmail": "admin@yourdomain.com"  // Important!
  }
}
```

### Code Logic

```csharp
private async Task CheckAndNotifyLowStockAsync(Product product, CancellationToken cancellationToken)
{
    // Check for low stock and send admin notification
    if (product.NotifyAdminForQuantityBelow && product.NotifyQuantityBelow.HasValue)
    {
        if (product.StockQuantity <= product.NotifyQuantityBelow.Value)
        {
            if (_emailService != null)
            {
                await _emailService.SendLowStockAlertToAdminAsync(
                    product.Name,
                    product.Sku,
                    product.StockQuantity,
                    product.NotifyQuantityBelow.Value
                );
            }
        }
    }
}
```

### Multiple Alert Levels (Optional Enhancement)

Aap multiple levels bhi set kar sakte hain:

```json
{
  "productId": "product-guid",
  "alerts": [
    {
      "threshold": 50,
      "message": "Warning: Stock below 50"
    },
    {
      "threshold": 20,
      "message": "Alert: Stock below 20"
    },
    {
      "threshold": 10,
      "message": "Critical: Stock below 10"
    }
  ]
}
```

### Benefits

- **Proactive Management:** Problem hone se pehle pata chal jata hai
- **Prevent Stockouts:** Revenue loss nahi hota
- **Customizable:** Har product ke liye alag threshold
- **Automated:** Manual checking nahi karni padti

---

## Feature 6: Order Status Management

### Problem Statement
1. Shipment create karne pe order status confusing tha
2. Status numbers (1, 2, 3...) ke bajaye readable strings chahiye the

### Solution
1. Proper status flow implement kiya
2. Enum serialization string format mein change kiya

### Order Status Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Pending   ‚îÇ (Order created)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Confirmed  ‚îÇ (Payment confirmed)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Processing  ‚îÇ (Being prepared)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚ñº                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Shipped   ‚îÇ   ‚îÇ PartiallyShipped ‚îÇ (Some items shipped)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                   ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ  Delivered  ‚îÇ (Customer received)
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Alternative Flows:**
```
Any Status ‚îÄ‚îÄ> Cancelled ‚îÄ‚îÄ> Refunded
Delivered ‚îÄ‚îÄ> Returned
```

### Status Codes

| Status Value | Integer | Description |
|--------------|---------|-------------|
| Pending | 1 | Order just created |
| Confirmed | 2 | Payment confirmed |
| Processing | 3 | Being prepared for shipment |
| Shipped | 4 | All items shipped |
| Delivered | 5 | Customer received order |
| Cancelled | 6 | Order cancelled |
| Refunded | 7 | Money refunded to customer |
| PartiallyShipped | 8 | Some items shipped, some pending |
| Returned | 9 | Customer returned the order |

### API Response Examples

**Before Fix:**
```json
{
  "orderNumber": "ORD-001",
  "status": 8,  // ‚ùå Not readable
  "totalAmount": 100.00
}
```

**After Fix:**
```json
{
  "orderNumber": "ORD-001",
  "status": "PartiallyShipped",  // ‚úÖ Clear and readable
  "totalAmount": 100.00
}
```

### Shipment Creation Flow

**Correct Implementation:**

```javascript
// Step 1: Create Shipment
POST /api/orders/{orderId}/shipments
{
  "trackingNumber": "RM123456789GB",
  "carrier": "Royal Mail",
  "shippingMethod": "Standard Delivery"
}

// Response
{
  "success": true,
  "data": {
    "orderId": "order-guid",
    "status": "Shipped",  // ‚úÖ NOT "Delivered"
    "shipment": {
      "trackingNumber": "RM123456789GB"
    }
  }
}

// Step 2: Mark as Delivered (Later, when customer receives)
POST /api/orders/{orderId}/mark-delivered
{
  "receivedBy": "John Doe",
  "deliveryNotes": "Left at door"
}

// Response
{
  "success": true,
  "data": {
    "orderId": "order-guid",
    "status": "Delivered",  // ‚úÖ Now marked as delivered
    "deliveredAt": "2025-12-15T14:30:00Z"
  }
}
```

### Code Comments Added

```csharp
// IMPORTANT: Set to Shipped, NOT Delivered
// The order will be marked as Delivered only when it's actually received by the customer
// Use MarkOrderDeliveredCommand to mark as delivered after shipment
order.Status = OrderStatus.Shipped;
```

### Benefits

- **Clear Status:** Sabko samajh aa jata hai current state kya hai
- **Proper Flow:** Shipment aur Delivery clearly separated
- **Better UX:** Frontend pe readable status show kar sakte hain
- **API Standards:** REST API best practices follow karta hai

---

## Database Schema Changes

### New Tables Created

#### 1. ProductBrands
```sql
CREATE TABLE [ProductBrands] (
    [Id] uniqueidentifier NOT NULL PRIMARY KEY,
    [ProductId] uniqueidentifier NOT NULL,
    [BrandId] uniqueidentifier NOT NULL,
    [IsPrimary] bit NOT NULL DEFAULT 0,
    [DisplayOrder] int NOT NULL DEFAULT 1,
    [CreatedAt] datetime2 NOT NULL,
    [UpdatedAt] datetime2 NULL,
    [CreatedBy] nvarchar(max) NULL,
    [UpdatedBy] nvarchar(max) NULL,
    [IsDeleted] bit NOT NULL DEFAULT 0,

    CONSTRAINT [FK_ProductBrands_Products]
        FOREIGN KEY ([ProductId]) REFERENCES [Products] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_ProductBrands_Brands]
        FOREIGN KEY ([BrandId]) REFERENCES [Brands] ([Id]) ON DELETE CASCADE
);

CREATE UNIQUE INDEX [IX_ProductBrands_ProductId_BrandId]
    ON [ProductBrands] ([ProductId], [BrandId]);
```

#### 2. ProductAdminCommentHistories
```sql
CREATE TABLE [ProductAdminCommentHistories] (
    [Id] uniqueidentifier NOT NULL PRIMARY KEY,
    [ProductId] uniqueidentifier NOT NULL,
    [OldComment] nvarchar(max) NULL,
    [NewComment] nvarchar(max) NULL,
    [ChangedBy] nvarchar(255) NOT NULL,
    [ChangedAt] datetime2 NOT NULL,
    [ChangeReason] nvarchar(max) NULL,
    [CreatedAt] datetime2 NOT NULL,
    [UpdatedAt] datetime2 NULL,
    [CreatedBy] nvarchar(max) NULL,
    [UpdatedBy] nvarchar(max) NULL,
    [IsDeleted] bit NOT NULL DEFAULT 0,

    CONSTRAINT [FK_ProductAdminCommentHistories_Products]
        FOREIGN KEY ([ProductId]) REFERENCES [Products] ([Id]) ON DELETE CASCADE
);

CREATE INDEX [IX_ProductAdminCommentHistories_ProductId]
    ON [ProductAdminCommentHistories] ([ProductId]);
CREATE INDEX [IX_ProductAdminCommentHistories_ChangedAt]
    ON [ProductAdminCommentHistories] ([ChangedAt]);
```

#### 3. ProductEditLocks
```sql
CREATE TABLE [ProductEditLocks] (
    [Id] uniqueidentifier NOT NULL PRIMARY KEY,
    [ProductId] uniqueidentifier NOT NULL,
    [LockedBy] nvarchar(255) NOT NULL,
    [LockedByEmail] nvarchar(255) NULL,
    [LockedAt] datetime2 NOT NULL,
    [ExpiresAt] datetime2 NOT NULL,
    [UserSessionId] nvarchar(max) NULL,
    [CreatedAt] datetime2 NOT NULL,
    [UpdatedAt] datetime2 NULL,
    [CreatedBy] nvarchar(max) NULL,
    [UpdatedBy] nvarchar(max) NULL,
    [IsDeleted] bit NOT NULL DEFAULT 0,

    CONSTRAINT [FK_ProductEditLocks_Products]
        FOREIGN KEY ([ProductId]) REFERENCES [Products] ([Id]) ON DELETE CASCADE
);

CREATE UNIQUE INDEX [IX_ProductEditLocks_ProductId]
    ON [ProductEditLocks] ([ProductId]);
CREATE INDEX [IX_ProductEditLocks_ExpiresAt]
    ON [ProductEditLocks] ([ExpiresAt]);
```

#### 4. BackInStockSubscriptions
```sql
CREATE TABLE [BackInStockSubscriptions] (
    [Id] uniqueidentifier NOT NULL PRIMARY KEY,
    [ProductId] uniqueidentifier NOT NULL,
    [ProductVariantId] uniqueidentifier NULL,
    [CustomerEmail] nvarchar(255) NOT NULL,
    [CustomerId] uniqueidentifier NULL,
    [SubscribedAt] datetime2 NOT NULL,
    [IsNotified] bit NOT NULL DEFAULT 0,
    [NotifiedAt] datetime2 NULL,
    [NotificationStatus] nvarchar(50) NULL DEFAULT N'Pending',
    [CreatedAt] datetime2 NOT NULL,
    [UpdatedAt] datetime2 NULL,
    [CreatedBy] nvarchar(max) NULL,
    [UpdatedBy] nvarchar(max) NULL,
    [IsDeleted] bit NOT NULL DEFAULT 0,

    CONSTRAINT [FK_BackInStockSubscriptions_Products]
        FOREIGN KEY ([ProductId]) REFERENCES [Products] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_BackInStockSubscriptions_ProductVariants]
        FOREIGN KEY ([ProductVariantId]) REFERENCES [ProductVariants] ([Id])
);

CREATE INDEX [IX_BackInStockSubscriptions_ProductId]
    ON [BackInStockSubscriptions] ([ProductId]);
CREATE INDEX [IX_BackInStockSubscriptions_CustomerEmail]
    ON [BackInStockSubscriptions] ([CustomerEmail]);
CREATE INDEX [IX_BackInStockSubscriptions_IsNotified]
    ON [BackInStockSubscriptions] ([IsNotified]);
CREATE INDEX [IX_BackInStockSubscriptions_ProductId_CustomerEmail]
    ON [BackInStockSubscriptions] ([ProductId], [CustomerEmail]);
```

### Migration Details

**Migration Name:** `20251215060522_AddAdvancedProductFeatures`

**Applied:** December 15, 2025

**Files Created:**
- `Migrations/20251215060522_AddAdvancedProductFeatures.cs`
- `Migrations/20251215060522_AddAdvancedProductFeatures.Designer.cs`
- `Migrations/ApplicationDbContextModelSnapshot.cs` (Updated)

### Verify Migration

```sql
-- Check if migration applied
SELECT * FROM __EFMigrationsHistory
WHERE MigrationId = '20251215060522_AddAdvancedProductFeatures';

-- Check if all tables exist
SELECT TABLE_NAME
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME IN (
    'ProductBrands',
    'ProductAdminCommentHistories',
    'ProductEditLocks',
    'BackInStockSubscriptions'
);
```

---

## API Endpoints Reference

### Product Management

#### Create Product with Multiple Brands
```http
POST /api/products
Authorization: Bearer {admin-token}
Content-Type: application/json

{
  "name": "Product Name",
  "sku": "SKU-001",
  "brandIds": ["brand-guid-1", "brand-guid-2"],
  "price": 19.99
}
```

#### Update Product
```http
PUT /api/products/{productId}
Authorization: Bearer {admin-token}
Content-Type: application/json

{
  "name": "Updated Name",
  "brandIds": ["brand-guid-1", "brand-guid-3"],
  "stockQuantity": 50
}
```

### Edit Locking

#### Acquire Edit Lock
```http
POST /api/products/{productId}/lock?durationMinutes=15
Authorization: Bearer {admin-token}
```

**Response:**
```json
{
  "success": true,
  "message": "Product edit lock acquired successfully",
  "data": {
    "id": "lock-guid",
    "productId": "product-guid",
    "lockedBy": "admin@example.com",
    "lockedByEmail": "admin@example.com",
    "lockedAt": "2025-12-15T10:00:00Z",
    "expiresAt": "2025-12-15T10:15:00Z",
    "isLocked": true
  }
}
```

#### Release Edit Lock
```http
DELETE /api/products/{productId}/lock
Authorization: Bearer {admin-token}
```

**Response:**
```json
{
  "success": true,
  "message": "Product edit lock released successfully",
  "data": true
}
```

### Back-in-Stock Notifications

#### Subscribe to Notifications
```http
POST /api/products/{productId}/back-in-stock-subscription
Content-Type: application/json

{
  "customerEmail": "customer@example.com",
  "productVariantId": null
}
```

**Response:**
```json
{
  "success": true,
  "message": "Successfully subscribed to back-in-stock notifications",
  "data": {
    "id": "subscription-guid",
    "productId": "product-guid",
    "customerEmail": "customer@example.com",
    "subscribedAt": "2025-12-15T10:00:00Z",
    "isNotified": false,
    "productName": "Product Name"
  }
}
```

### Order Management

#### Create Shipment
```http
POST /api/orders/{orderId}/shipments
Authorization: Bearer {admin-token}
Content-Type: application/json

{
  "trackingNumber": "RM123456789GB",
  "carrier": "Royal Mail",
  "shippingMethod": "Standard Delivery",
  "shippingCost": 5.99
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "orderId": "order-guid",
    "status": "Shipped",
    "shipment": {
      "id": "shipment-guid",
      "trackingNumber": "RM123456789GB",
      "carrier": "Royal Mail"
    }
  }
}
```

#### Mark Order as Delivered
```http
POST /api/orders/{orderId}/mark-delivered
Authorization: Bearer {admin-token}
Content-Type: application/json

{
  "receivedBy": "John Doe",
  "deliveryNotes": "Left at door",
  "deliveredAt": "2025-12-15T14:30:00Z"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "orderId": "order-guid",
    "orderNumber": "ORD-001",
    "status": "Delivered",
    "deliveredAt": "2025-12-15T14:30:00Z"
  }
}
```

---

## Configuration Guide

### appsettings.json

Complete configuration with all required settings:

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=EcomPlatform;Trusted_Connection=True;TrustServerCertificate=True"
  },

  "JwtSettings": {
    "SecretKey": "YourSuperSecretKeyHere_MinimumLength32Characters",
    "Issuer": "EcomPlatform",
    "Audience": "EcomPlatformUsers",
    "ExpiryMinutes": 60
  },

  "EmailSettings": {
    "SmtpServer": "smtp.gmail.com",
    "Port": 587,
    "Username": "your-email@gmail.com",
    "Password": "your-app-specific-password",
    "FromName": "Direct Care E-Commerce",
    "AdminEmail": "admin@yourdomain.com"
  },

  "Stripe": {
    "SecretKey": "sk_test_your_stripe_secret_key",
    "PublishableKey": "pk_test_your_stripe_publishable_key"
  },

  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },

  "AllowedHosts": "*"
}
```

### Gmail App Password Setup

1. Go to: https://myaccount.google.com/security
2. Enable 2-Step Verification
3. Go to: https://myaccount.google.com/apppasswords
4. Generate new app password
5. Use that password in `EmailSettings.Password`

### Database Connection

**SQL Server:**
```json
"DefaultConnection": "Server=localhost;Database=EcomPlatform;Trusted_Connection=True;TrustServerCertificate=True"
```

**SQL Server with credentials:**
```json
"DefaultConnection": "Server=localhost;Database=EcomPlatform;User Id=sa;Password=YourPassword;TrustServerCertificate=True"
```

**Azure SQL:**
```json
"DefaultConnection": "Server=tcp:yourserver.database.windows.net,1433;Database=EcomPlatform;User Id=yourusername;Password=yourpassword;Encrypt=True"
```

---

## Testing Guide

### Feature Testing Checklist

#### 1. Multiple Brands Testing

**Test Case 1: Create product with multiple brands**
```bash
curl -X POST https://localhost:7000/api/products \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Product",
    "sku": "TEST-001",
    "brandIds": ["brand-1", "brand-2", "brand-3"],
    "price": 29.99,
    "categoryId": "category-1"
  }'
```

**Expected:**
- Product created successfully
- 3 ProductBrand records created
- First brand marked as Primary
- DisplayOrder: 1, 2, 3

**Test Case 2: Update brands**
```bash
curl -X PUT https://localhost:7000/api/products/{productId} \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "brandIds": ["brand-1", "brand-4"]
  }'
```

**Expected:**
- Old brands removed (brand-2, brand-3)
- New brand added (brand-4)
- Brand-1 remains as Primary

#### 2. Edit Locking Testing

**Test Case 1: Acquire lock**
```bash
# User 1
curl -X POST https://localhost:7000/api/products/{productId}/lock?durationMinutes=5 \
  -H "Authorization: Bearer {user1-token}"
```

**Expected:**
- Lock acquired successfully
- ExpiresAt = LockedAt + 5 minutes

**Test Case 2: Try to edit (different user)**
```bash
# User 2
curl -X PUT https://localhost:7000/api/products/{productId} \
  -H "Authorization: Bearer {user2-token}" \
  -H "Content-Type: application/json" \
  -d '{"name": "Updated"}'
```

**Expected:**
- 409 Conflict error
- Error message shows who is editing

**Test Case 3: Release lock**
```bash
# User 1
curl -X DELETE https://localhost:7000/api/products/{productId}/lock \
  -H "Authorization: Bearer {user1-token}"
```

**Expected:**
- Lock removed
- Now User 2 can edit

#### 3. Back-in-Stock Testing

**Test Case 1: Subscribe**
```bash
curl -X POST https://localhost:7000/api/products/{productId}/back-in-stock-subscription \
  -H "Content-Type: application/json" \
  -d '{
    "customerEmail": "test@example.com"
  }'
```

**Expected:**
- Subscription created
- NotificationStatus = "Pending"

**Test Case 2: Stock update triggers notification**
```bash
curl -X PUT https://localhost:7000/api/products/{productId} \
  -H "Authorization: Bearer {admin-token}" \
  -H "Content-Type: application/json" \
  -d '{
    "stockQuantity": 50
  }'
```

**Expected:**
- Email sent to test@example.com
- NotificationStatus = "Sent"
- NotifiedAt = current time

#### 4. Low Stock Alert Testing

**Test Case 1: Configure product**
```bash
curl -X PUT https://localhost:7000/api/products/{productId} \
  -H "Authorization: Bearer {admin-token}" \
  -H "Content-Type: application/json" \
  -d '{
    "notifyAdminForQuantityBelow": true,
    "notifyQuantityBelow": 10,
    "stockQuantity": 50
  }'
```

**Expected:**
- Settings saved

**Test Case 2: Decrease stock below threshold**
```bash
curl -X PUT https://localhost:7000/api/products/{productId} \
  -H "Authorization: Bearer {admin-token}" \
  -H "Content-Type: application/json" \
  -d '{
    "stockQuantity": 8
  }'
```

**Expected:**
- Email sent to admin
- Subject: "‚ö†Ô∏è Low Stock Alert: Product Name"

### Database Verification Queries

```sql
-- Check ProductBrands
SELECT p.Name, b.Name as BrandName, pb.IsPrimary, pb.DisplayOrder
FROM ProductBrands pb
JOIN Products p ON pb.ProductId = p.Id
JOIN Brands b ON pb.BrandId = b.Id
WHERE p.Id = 'your-product-guid';

-- Check Admin Comment History
SELECT
    OldComment,
    NewComment,
    ChangedBy,
    ChangedAt
FROM ProductAdminCommentHistories
WHERE ProductId = 'your-product-guid'
ORDER BY ChangedAt DESC;

-- Check Active Locks
SELECT
    p.Name as ProductName,
    LockedBy,
    LockedByEmail,
    LockedAt,
    ExpiresAt,
    CASE WHEN ExpiresAt > GETDATE() THEN 'Active' ELSE 'Expired' END as LockStatus
FROM ProductEditLocks l
JOIN Products p ON l.ProductId = p.Id
WHERE l.IsDeleted = 0;

-- Check Back-in-Stock Subscriptions
SELECT
    p.Name as ProductName,
    CustomerEmail,
    SubscribedAt,
    IsNotified,
    NotificationStatus
FROM BackInStockSubscriptions s
JOIN Products p ON s.ProductId = p.Id
WHERE s.IsDeleted = 0;
```

---

## Troubleshooting

### Common Issues

#### 1. Email Not Sending

**Problem:** Back-in-stock or low stock emails not working

**Solution:**
1. Check `appsettings.json` EmailSettings
2. Verify Gmail App Password (not regular password)
3. Check SMTP port (587 for TLS, 465 for SSL)
4. Check logs for error messages

```bash
# Test email configuration
dotnet run --project EcomPlatform.API
# Check console for email errors
```

#### 2. Edit Lock Not Working

**Problem:** Multiple users can edit simultaneously

**Solution:**
1. Verify migration applied:
```sql
SELECT * FROM __EFMigrationsHistory
WHERE MigrationId LIKE '%AddAdvancedProductFeatures%';
```

2. Check ProductEditLocks table exists:
```sql
SELECT * FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME = 'ProductEditLocks';
```

3. Verify lock expiration time is not too short

#### 3. Brands Not Showing

**Problem:** Multiple brands not appearing in product

**Solution:**
1. Check request format - use `brandIds` array, not `brandId`
2. Verify brands exist in database
3. Check ProductBrands table for entries:
```sql
SELECT * FROM ProductBrands WHERE ProductId = 'your-product-guid';
```

#### 4. Status Showing as Number

**Problem:** Order status showing as 8 instead of "PartiallyShipped"

**Solution:**
1. Verify `JsonStringEnumConverter` added in Program.cs:
```csharp
options.JsonSerializerOptions.Converters.Add(
    new System.Text.Json.Serialization.JsonStringEnumConverter()
);
```

2. Restart application after code change

---

## Best Practices

### 1. Multiple Brands
- Always set at least one brand as Primary
- Use meaningful DisplayOrder
- Don't exceed 5-6 brands per product (UX consideration)

### 2. Edit Locking
- Default 15 minutes is good for most cases
- Auto-extend lock every 10 minutes if user is active
- Always release lock on save/cancel

### 3. Back-in-Stock
- Validate email format before subscription
- Prevent duplicate subscriptions (same email + product)
- Send notification only once per subscription

### 4. Low Stock Alerts
- Set reasonable thresholds (10-15% of average order quantity)
- Don't set too low (risk of stockout)
- Review and adjust based on sales velocity

### 5. Email Configuration
- Use app-specific passwords, not account passwords
- Test emails in staging before production
- Monitor email delivery rates
- Have fallback notification method (SMS, etc.)

---

## Performance Considerations

### Indexing Strategy

All critical indexes already created:
- `IX_ProductBrands_ProductId_BrandId` (Unique)
- `IX_ProductEditLocks_ProductId` (Unique)
- `IX_ProductEditLocks_ExpiresAt`
- `IX_BackInStockSubscriptions_ProductId_CustomerEmail`
- `IX_ProductAdminCommentHistories_ProductId`

### Query Optimization

**Good:**
```csharp
// Eager loading
var product = await _context.Products
    .Include(p => p.ProductBrands)
        .ThenInclude(pb => pb.Brand)
    .FirstOrDefaultAsync(p => p.Id == productId);
```

**Bad:**
```csharp
// N+1 queries
var product = await _context.Products.FirstOrDefaultAsync(p => p.Id == productId);
foreach (var pb in product.ProductBrands)
{
    var brand = await _context.Brands.FindAsync(pb.BrandId); // N+1!
}
```

### Caching Recommendations

```csharp
// Cache product brands (they don't change frequently)
services.AddMemoryCache();

// In your service
var cacheKey = $"product_brands_{productId}";
if (!_cache.TryGetValue(cacheKey, out List<Brand> brands))
{
    brands = await GetProductBrandsAsync(productId);
    _cache.Set(cacheKey, brands, TimeSpan.FromHours(1));
}
```

---

## Future Enhancements

### Suggested Improvements

1. **Real-time Edit Locking**
   - Use SignalR for live lock updates
   - Show "User X is editing" indicator in real-time

2. **Advanced Notifications**
   - SMS notifications option
   - Push notifications for mobile app
   - WhatsApp Business API integration

3. **Analytics Dashboard**
   - Track back-in-stock conversion rate
   - Monitor low stock alert effectiveness
   - Edit locking statistics

4. **Bulk Operations**
   - Bulk brand assignment
   - Bulk stock updates
   - Batch notification sending

5. **Multi-language Support**
   - Email templates in multiple languages
   - Localized status messages

---

## Support & Contact

For any questions or issues:

**Email:** support@yourdomain.com
**Documentation:** https://docs.yourdomain.com
**API Reference:** https://api.yourdomain.com/swagger

---

**Document Version:** 1.0
**Last Updated:** December 15, 2025
**Author:** Development Team
**Status:** Production Ready ‚úÖ

---

## Appendix: Quick Reference

### API Endpoints Summary

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/products` | POST | Create product with multiple brands |
| `/api/products/{id}` | PUT | Update product/brands/stock |
| `/api/products/{id}/lock` | POST | Acquire edit lock |
| `/api/products/{id}/lock` | DELETE | Release edit lock |
| `/api/products/{id}/back-in-stock-subscription` | POST | Subscribe to notifications |
| `/api/orders/{id}/shipments` | POST | Create shipment |
| `/api/orders/{id}/mark-delivered` | POST | Mark as delivered |

### Database Tables Summary

| Table | Purpose | Key Columns |
|-------|---------|-------------|
| ProductBrands | Multiple brands per product | ProductId, BrandId, IsPrimary |
| ProductAdminCommentHistories | Audit trail | OldComment, NewComment, ChangedBy |
| ProductEditLocks | Edit locking | ProductId, LockedBy, ExpiresAt |
| BackInStockSubscriptions | Customer notifications | ProductId, CustomerEmail, IsNotified |

### Configuration Summary

```json
{
  "EmailSettings": {
    "AdminEmail": "Required for low stock alerts"
  },
  "JsonOptions": {
    "UseStringEnumConverter": true
  }
}
```

---

**END OF DOCUMENTATION**
